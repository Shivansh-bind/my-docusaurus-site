---

# ReferenceLibrary v2 â€” Step-by-Step Build Plan (GitHub Releases Packs)

## Phase 0 â€” Final Decisions (Confirm)

### âœ… We will use:

* **GitHub Releases** for distributing study asset packs (ZIP)
* **Manifest-driven navigation** (`index.json`)
* **HTML export** for mobile rendering (WebView)
* **docId-based routing** inside the app
* Optional: **Supabase auth + progress sync** later

---

# Phase 1 â€” Repo Structure (Foundation)

### 1.1 Add folders to repo

Create these folders:

```
/content/                   # app-ready exported content will go here (build output)
/content_build/             # scripts and configs to export content
/apps/mobile/               # flutter app
/website/                   # docusaurus site
```

---

# Phase 2 â€” docId Standardization (Most Important)

## 2.1 Create doc registry file

Create:

âœ… `content_build/doc_registry.json`

This is the authoritative list of docs for both:

* manifest generation
* export naming
* stable IDs forever

Example:

```json
{
  "s1_cprog_index": {
    "title": "C Programming",
    "semester": 1,
    "subject": "C Programming",
    "type": "index",
    "order": 0,
    "source": "website/docs/Semester 1/C-Programming/index.mdx"
  },
  "s1_cprog_handout": {
    "title": "ğŸ“˜ Handout",
    "semester": 1,
    "subject": "C Programming",
    "type": "handout",
    "order": 1,
    "source": "website/docs/Semester 1/C-Programming/Handout/index.mdx"
  }
}
```

### Rules

* docId never changes
* source can move, docId doesnâ€™t

---

# Phase 3 â€” Export Pipeline (MDX â†’ HTML)

## 3.1 Add build script

Create:

âœ… `content_build/export_docs.js`

Job:

* read doc_registry.json
* take each MDX source
* convert to HTML
* rewrite internal links
* output to `/content/docs/<docId>.html`

### Output format

```
content/
  index.json
  docs/
    s1_cprog_handout.html
    s2_dm_handout.html
  assets/
    css/
    js/
    img/
```

---

## 3.2 MDX â†’ HTML approach (recommended)

Use **Docusaurus build output** itself to avoid custom MDX parsing.

### Best method:

* Build Docusaurus once
* Extract the rendered HTML per doc route
* Save it as `<docId>.html`
* Copy required static assets

This keeps perfect styling and supports interactive web components later.

---

## 3.3 Link rewriting rule (critical fix)

Inside exported HTML, rewrite:

* any link to `/docs/...` OR relative links
  into:
* `app://doc/<docId>`

### Example

`<a href="/docs/Semester%201/C-Programming/Handout/">Handout</a>`

becomes:
`<a href="app://doc/s1_cprog_handout">Handout</a>`

How do we know docId?

* build a lookup from Docusaurus `docs-*.json` output (you already accessed this earlier)
* map route â†’ docId

---

# Phase 4 â€” Manifest Generation (`index.json`)

## 4.1 Build `index.json` generator

Create:

âœ… `content_build/generate_manifest.js`

It will output:

âœ… `content/index.json`

Must include:

* packVersion
* generatedAt
* docs lookup
* tree nav structure

Example:

```json
{
  "packVersion": "2026.01.13",
  "generatedAt": "2026-01-13T10:00:00Z",
  "docs": {
    "s1_cprog_handout": {
      "title": "ğŸ“˜ Handout",
      "html": "docs/s1_cprog_handout.html",
      "semester": 1,
      "subject": "C Programming",
      "type": "handout",
      "order": 1
    }
  },
  "tree": [
    {
      "id": "semester_1",
      "title": "Semester 1",
      "items": [
        {
          "id": "s1_cprog",
          "title": "C Programming",
          "items": [
            { "docId": "s1_cprog_index" },
            { "docId": "s1_cprog_handout" }
          ]
        }
      ]
    }
  ]
}
```

This manifest = your **app navigation engine**.

---

# Phase 5 â€” Pack ZIP creation

## 5.1 Create pack builder

Create:

âœ… `content_build/build_pack.js`

Steps:

1. run docusaurus build
2. export docs to HTML into `content/docs`
3. generate `content/index.json`
4. copy required assets â†’ `content/assets`
5. zip the `content/` folder into:

âœ… `release_pack_<packVersion>.zip`

---

# Phase 6 â€” Upload to GitHub Releases (Automation)

## 6.1 Create GitHub Action workflow

Create:

âœ… `.github/workflows/release_pack.yml`

Workflow triggers:

* manual (`workflow_dispatch`)
* or tag `pack-v*`

Steps:

1. checkout
2. install node
3. run `npm ci`
4. run export scripts
5. zip pack
6. create release
7. upload zip + manifest

Release assets:

* `release_pack_2026.01.13.zip`
* `index.json` (optional separate)

This makes updates easy forever.

---

# Phase 7 â€” Flutter App (New architecture)

## 7.1 App flow

### First launch:

* check local `index.json`
* if missing: show â€œGet Study Assetsâ€
* download latest pack from GitHub release
* extract
* load manifest
* show tree

### Always:

* reader loads local HTML
* all interactions stay inside app
* external links open browser

---

## 7.2 App storage layout

Inside device storage:

```
/appData/referenceLibrary/
  packs/
    current/
      index.json
      docs/*.html
      assets/*
  db/
    progress.sqlite
```

---

## 7.3 Pack download manager

Feature: **Download + Extract + Replace**

* download ZIP to temp
* extract into packs/new
* validate manifest exists
* swap packs/current â†’ packs/old
* packs/new â†’ packs/current
* keep db untouched

---

## 7.4 Reader logic (clean)

Reader receives:

* `docId`
* uses manifest to load `file://.../<html path>`
* WebView intercepts:

  * `app://doc/<docId>` â†’ navigate inside app
  * `https://external.com` â†’ open browser

This fully fixes Semester 1 / Semester 2 differences permanently.

---

# Phase 8 â€” Adding new docs/categories later (super easy)

## When you add a new doc:

1. create MDX file
2. add entry in `doc_registry.json`
3. set tree placement in manifest config
4. run workflow â†’ new release

Students:

* open app
* sees update available
* downloads new pack
* instantly gets new category/doc

No pipeline break.

---

# Verification Checklist (must-do)

## Mobile automated

Inside `apps/mobile`:

```bash
dart format .
flutter analyze
flutter test -r compact
```

## Manual

* Install app fresh
* Get Study Assets â†’ download pack
* open Semester 1 doc â†’ click internal link â†’ stays in app âœ…
* airplane mode â†’ open docs instantly âœ…

---

# Deliverables (What we will end up with)

âœ… GitHub Releases pack system
âœ… Manifest-driven offline doc library
âœ… Reader that loads local HTML
âœ… Stable docId navigation
âœ… Infinite future UI redesign possible without breaking logic

---